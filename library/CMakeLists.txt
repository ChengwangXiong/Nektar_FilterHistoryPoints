CMAKE_MINIMUM_REQUIRED(VERSION 2.4.2)
PROJECT(Nektar++)

# Find the modules included with Nektar
SET(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR} ${CMAKE_MODULE_PATH})
SET(CMAKE_INSTALL_PREFIX ${CMAKE_BINARY_DIR}/dist CACHE FILEPATH "" FORCE)

IF( ${CMAKE_COMPILER_IS_GNUCXX} )
	SET(USE_GCOV OFF CACHE BOOL "Use gcov coverage testing." )
ENDIF( ${CMAKE_COMPILER_IS_GNUCXX} )

SET(USE_MKL OFF CACHE BOOL "Use the Intel Math Kernel Library (MKL) for BLAS and Lapack support." )
SET(USE_ATLAS OFF CACHE BOOL "Use ATLAS for BLAS and Lapack support." )

SET(USE_EXPRESSION_TEMPLATES ON CACHE BOOL "")

INCLUDE (FindBoost)
INCLUDE (FindLoki)

IF( USE_MKL )
    INCLUDE (FindMKL)
ENDIF( USE_MKL )

IF( USE_ATLAS )
    INCLUDE( FindAtlas )
ENDIF( USE_ATLAS )

INCLUDE_DIRECTORIES( ${CMAKE_SOURCE_DIR} ${BOOST_INCLUDE_DIR} ${LOKI_INCLUDE_DIR} ${PROJECT_BINARY_DIR})

SET(NEKTAR_VERSION 0.1.1)
SET(NEKTAR_BIN_DIR /bin)
SET(NEKTAR_LIB_DIR /lib)
SET(NEKTAR_INCLUDE_DIR /include)

MACRO(ADD_NEKTAR_LIBRARY name type)
    ADD_LIBRARY(${name} ${type} ${ARGN})

    SET_TARGET_PROPERTIES(${name} PROPERTIES VERSION ${NEKTAR_VERSION})

    SET_TARGET_PROPERTIES(${name} PROPERTIES DEBUG_POSTFIX -g)
    SET_TARGET_PROPERTIES(${name} PROPERTIES MINSIZEREL_POSTFIX -ms)
    SET_TARGET_PROPERTIES(${name} PROPERTIES RELWITHDEBINFO_POSTFIX -rg)

    INSTALL_TARGETS(${NEKTAR_LIB_DIR} ${name})
    
ENDMACRO(ADD_NEKTAR_LIBRARY name)

IF( ${CMAKE_COMPILER_IS_GNUCXX} )	
	IF( USE_GCOV )
		ADD_DEFINITIONS(-fprofile-arcs -ftest-coverage)
	ENDIF( USE_GCOV )
ENDIF( ${CMAKE_COMPILER_IS_GNUCXX} )

IF( USE_EXPRESSION_TEMPLATES )
    ADD_DEFINITIONS(-DNEKTAR_USE_EXPRESSION_TEMPLATES -DNEKTAR_USING_CMAKE)
ENDIF( USE_EXPRESSION_TEMPLATES )

IF( USE_MKL )
    SET(NEKTAR_USING_BLAS TRUE)
    SET(NEKTAR_USING_LAPACK TRUE)
    SET(NEKTAR_USING_MKL TRUE)
ENDIF( USE_MKL )

IF( USE_ATLAS )
    SET(NEKTAR_USING_BLAS TRUE)
    SET(NEKTAR_USING_ATLAS TRUE)
ENDIF( USE_ATLAS )

SUBDIRS(LibUtilities LocalRegions MultiRegions SpatialDomains StdRegions Stochastic UnitTests)

